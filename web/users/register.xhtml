<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
    <f:view contentType="text/html"/>
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
        <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
        <title>Cadastro</title>
        <!-- BEGIN PAGE STYLES -->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"></link>
        <link type="text/css" rel="StyleSheet" media="all" href="/resources/common/css/reset.css"></link>
        <link type="text/css" rel="StyleSheet" media="all" href="/resources/common/css/global.css"></link>
        <link type="text/css" rel="StyleSheet" media="all" href="/resources/common/css/login.css"></link>
        <!-- END PAGE STYLES -->
        <link rel="shortcut icon" href="/resources/common/images/guigoh.png"></link>
    </h:head>
    <h:body>
        <f:event type="preRenderComponent" listener="#{registerBean.init()}"/>
        <header>
            <div class="container">
                <div class="header-logo">
                    <img class="logo-guigoh" src="../resources/common/images/logo-guigoh.png"></img>
                    <img class="logo-ipti" src="../resources/common/images/logo-ipti.png"></img>
                </div>
                <div class="title">
                    <h1>Cadastro</h1>
                </div>
            </div>
        </header>
        <section>
            <h:form prependId="false">
                <div class="container">
                    <div class="content">
                        <div class="main-register">
                            <h:messages styleClass="msg" errorClass="error" infoClass="info"/>
                            <div class="profile">
                                <p style="font-size: 22px">Olá calouro!</p>
                                <p>Seu cadastro no Guigoh é simples e fácil. Por favor preencha os campos abaixo.</p>
                                <form>
                                    <div class="col-2">
                                        <h:inputText pt:placeholder="Nome" value="#{registerBean.socialProfile.name}"></h:inputText>
                                        <h:inputText pt:placeholder="E-mail" value="#{registerBean.user.username}"></h:inputText>
                                        <h:inputSecret pt:placeholder="Senha" value="#{registerBean.user.password}"></h:inputSecret>
                                        <div class="select">
                                            <h:selectOneMenu value="#{registerBean.secretQuestion.id}">
                                                <f:selectItem itemLabel="Pergunta secreta" itemValue="0"/>
                                                <f:selectItems value="#{registerBean.questionsList}" var="questions" itemValue="#{questions.id}" itemLabel="#{questions.name}" />
                                            </h:selectOneMenu>
                                        </div>
                                        <hr></hr>
                                    </div>
                                    <div class="col-2">
                                        <h:inputText pt:placeholder="sobrenome" value="#{registerBean.lastName}"></h:inputText>
                                        <h:inputText pt:placeholder="confirmação de e-mail" value="#{registerBean.usernameConfirm}"></h:inputText>
                                        <h:inputSecret pt:placeholder="confirmação de senha" value="#{registerBean.passwordConfirm}"></h:inputSecret>
                                        <h:inputText pt:placeholder="resposta da pergunta secreta" value="#{registerBean.user.secretAnswer}"></h:inputText>
                                    </div>
                                    <div class="clear"></div>
                                </form>
                            </div>
                            <div class="school">
                                <p>Alguns dados sobre sua instituição de ensino.</p>
                                <div class="col-2">
                                    <div class="select">
                                        <h:selectOneMenu value="#{registerBean.subnetworkId}">
                                            <f:selectItem itemLabel="Selecione sua instituição de ensino" itemValue="0"/>
                                            <f:selectItems value="#{registerBean.subnetworkList}" var="subnetwork" itemValue="#{subnetwork.id}" itemLabel="#{subnetwork.description}" />
                                        </h:selectOneMenu>
                                    </div>
                                    <div class="select">
                                        <h:selectOneMenu value="#{registerBean.languageId}">
                                            <f:selectItem itemLabel="Selecione o idioma" itemValue="0"/>
                                            <f:selectItems value="#{registerBean.languageList}" var="language" itemValue="#{language.id}" itemLabel="#{language.description}" />
                                        </h:selectOneMenu>
                                    </div>
                                    <div class="select">
                                        <h:selectOneMenu id="state" value="#{registerBean.stateId}">
                                            <f:selectItem itemLabel="Selecione o estado" itemValue=""/>
                                            <f:selectItems value="#{registerBean.stateList}" var="state" itemValue="#{state.id}" itemLabel="#{state.name}" />
                                            <f:ajax event="change" render="city" listener="#{registerBean.loadCity()}"/>
                                        </h:selectOneMenu>
                                    </div>
                                </div>
                                <div class="col-2">
                                    <div class="select">
                                        <h:selectOneMenu value="#{registerBean.roleId}">
                                            <f:selectItem itemLabel="Selecione sua instituição de ensino" itemValue="0"/>
                                            <f:selectItems value="#{registerBean.roleList}" var="role" itemValue="#{role.id}" itemLabel="#{role.name}" />
                                        </h:selectOneMenu>
                                    </div>
                                    <div class="select">
                                        <h:selectOneMenu value="#{registerBean.countryId}">
                                            <f:selectItem itemLabel="Selecione o país" itemValue="0"/>
                                            <f:selectItems value="#{registerBean.countryList}" var="country" itemValue="#{country.id}" itemLabel="#{country.name}" />
                                            <f:ajax event="change" execute="@this" render="state" listener="#{registerBean.loadState}"/>
                                        </h:selectOneMenu>
                                    </div>
                                    <div class="select">
                                        <h:selectOneMenu id="city" value="#{registerBean.cityId}">
                                            <f:selectItem itemLabel="Selecione a cidade" itemValue=""/>
                                            <f:selectItems value="#{registerBean.cityList}" var="city" itemValue="#{city.id}" itemLabel="#{city.name}" />
                                        </h:selectOneMenu>
                                    </div>
                                </div>
                                <div class="buttons col-1">
                                    <a class="back pull-left" href="../auth/login.xhtml"><i class="fa fa-chevron-circle-left pull-left fa-2x fa-fw black"></i></a>
                                    <h:commandLink action="#{registerBean.register()}">
                                        <button class="submit pointer">Cadastre-se</button>
                                    </h:commandLink>
                                </div>
                                <div class="clear"></div>
                            </div>
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>
            </h:form>
        </section>
        <footer>
            <div class="container">
                <img src="../resources/common/images/footer.png"></img>
            </div>
        </footer>

        <!-- BEGIN PAGE SCRIPTS -->
        <script type="text/javascript" src="../resources/lib/js/jquery-1.11.3.min.js"/>
        <script>
            $('select').on("change", changeSelectColors).change();
            $('select').on("change", checkLength).change();
            function changeSelectColors() {
                if ($(this).children('option:first-child').is(':selected')) {
                    $(this).css("color", "rgba(0, 0, 0, 0.4)");
                } else {
                    $(this).css("color", "initial");
                }
                $(this).children("option").not(":eq(0)").css("color", "initial");
                $(this).children("option:first-child").css("color", "rgba(0, 0, 0, 0.4)");
            }
            function checkLength() {
                if ($(this).children("option:selected").text().trim().length > 45) {
                    var string = $(this).children("option:selected").text();
                    $(this).children("option:selected").text(string.substring(0, 45) + "...");
                }
            }

            $(document).on("keypress", "input", function(event) {
                if (event.which == 13) {
                    event.preventDefault();
                    $(".forward").click();
                }
            });

            function setCursors(ajax) {
                if (ajax === "begin") {
                    $('body').css('cursor', 'wait');
                    $('.row-details').css('cursor', 'wait');
                    $('a').css('cursor', 'wait');
                } else {
                    $('body').css('cursor', 'auto');
                    $('.row-details').css('cursor', 'pointer');
                    $('a').css('cursor', 'pointer');
                }
            }

            jsf.ajax.addOnEvent(function(data) {
                switch (data.status) {
                    case "begin":
                        setCursors(data.status);
                        break;
                    case "success":
                        setCursors(data.status);
                        break;
                }
            });

        </script>
        <!-- END PAGE SCRIPTS -->
    </h:body>
</html>
